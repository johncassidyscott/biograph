services:
  - type: web
    name: biograph-api
    env: python
    plan: free
    buildCommand: |
      pip install -r requirements.txt
      python -m biograph.scripts.run_migrations
    startCommand: uvicorn biograph.api.main:app --host 0.0.0.0 --port $PORT --workers 2
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: AUTH_MODE
        value: api_key
      - key: GRAPH_BACKEND
        value: postgres
      - key: DB_POOL_MIN_SIZE
        value: 5
      - key: DB_POOL_MAX_SIZE
        value: 20
