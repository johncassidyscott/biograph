<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BioGraph - Life Sciences Knowledge Graph</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

@keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
    background-size: 400% 400%;
    animation: gradient 15s ease infinite;
    min-height: 100vh;
    padding: 20px;
    color: #333;
}

.container {
    max-width: 1600px;
    margin: 0 auto;
}

/* Glassmorphism */
.glass {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

header {
    text-align: center;
    color: white;
    margin-bottom: 40px;
    padding: 60px 20px;
    animation: fadeIn 0.8s ease;
}

.header-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
}

header h1 {
    font-size: 4em;
    font-weight: 800;
    background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

header p {
    font-size: 1.4em;
    opacity: 0.95;
    font-weight: 300;
    letter-spacing: 0.5px;
}

.search-hero {
    max-width: 800px;
    margin: 30px auto 0;
    position: relative;
}

.search-input {
    width: 100%;
    padding: 20px 60px 20px 24px;
    font-size: 18px;
    border: none;
    border-radius: 50px;
    background: rgba(255, 255, 255, 0.95);
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    transition: all 0.3s;
}

.search-input:focus {
    outline: none;
    box-shadow: 0 10px 60px rgba(0,0,0,0.25);
    transform: translateY(-2px);
}

.search-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    padding: 12px 24px;
    border-radius: 50px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.search-btn:hover {
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    transform: translateY(-50%) scale(1.05);
}

.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
    animation: fadeIn 1s ease 0.2s both;
}

.stat-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    text-align: center;
    transition: all 0.3s;
    cursor: pointer;
}

.stat-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}

.stat-card .icon {
    font-size: 2.5em;
    margin-bottom: 10px;
}

.stat-card .number {
    font-size: 3em;
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
}

.stat-card .label {
    font-size: 0.95em;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-weight: 600;
}

.main-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 40px;
    margin-bottom: 40px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    animation: fadeIn 1.2s ease 0.4s both;
}

.tabs {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
    border-bottom: 2px solid rgba(102, 126, 234, 0.1);
    flex-wrap: wrap;
}

.tab {
    padding: 15px 30px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: #666;
    cursor: pointer;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.3s;
}

.tab:hover {
    color: #667eea;
    transform: none;
    box-shadow: none;
}

.tab.active {
    color: #667eea;
    border-bottom-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

h2 {
    color: #333;
    margin-bottom: 25px;
    font-size: 2em;
    font-weight: 700;
}

.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 12px;
    margin-bottom: 25px;
}

.quick-btn {
    padding: 15px 20px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border: 2px solid rgba(102, 126, 234, 0.2);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    color: #667eea;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.quick-btn:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.controls {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 25px;
}

select, input, button {
    padding: 14px 22px;
    font-size: 15px;
    border: 2px solid rgba(102, 126, 234, 0.2);
    border-radius: 12px;
    transition: all 0.3s;
    font-family: inherit;
}

select, input {
    background: white;
}

select:focus, input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

button:active {
    transform: translateY(0);
}

.results-container {
    min-height: 200px;
}

.entity-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.entity-card {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    border: 2px solid rgba(102, 126, 234, 0.1);
    border-radius: 15px;
    padding: 20px;
    transition: all 0.3s;
}

.entity-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
    border-color: #667eea;
}

.entity-card .entity-name {
    font-size: 1.2em;
    font-weight: 700;
    color: #333;
    margin-bottom: 8px;
}

.entity-card .entity-id {
    font-size: 0.85em;
    color: #667eea;
    font-family: monospace;
    background: rgba(102, 126, 234, 0.1);
    padding: 4px 10px;
    border-radius: 6px;
    display: inline-block;
    margin-bottom: 8px;
}

.entity-card .entity-kind {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.kind-drug { background: #e8f4fd; color: #1976d2; }
.kind-disease { background: #ffe8e8; color: #d32f2f; }
.kind-target { background: #fff3e0; color: #f57c00; }
.kind-trial { background: #f3e5f5; color: #7b1fa2; }
.kind-company { background: #e0f2f1; color: #00796b; }
.kind-publication { background: #fce4ec; color: #c2185b; }

.edge-card {
    background: white;
    border-left: 4px solid #667eea;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.3s;
}

.edge-card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    transform: translateX(5px);
}

.edge-card .edge-predicate {
    display: inline-block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    margin: 10px 0;
}

.edge-card .entity-label {
    font-weight: 600;
    color: #333;
    transition: all 0.3s;
}

.edge-card .entity-label[onclick]:hover {
    color: #667eea;
    text-decoration-color: #667eea !important;
}

.entity-card[onclick] {
    cursor: pointer;
}

.entity-card[onclick]:hover {
    transform: translateY(-8px) scale(1.02);
}

pre {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 12px;
    overflow: auto;
    max-height: 600px;
    font-size: 13px;
    line-height: 1.7;
    border: 1px solid #e0e0e0;
}

.loading {
    text-align: center;
    color: #667eea;
    font-style: italic;
    padding: 60px 20px;
    font-size: 1.1em;
}

.loading::after {
    content: '...';
    animation: pulse 1.5s infinite;
}

.footer {
    text-align: center;
    color: white;
    padding: 40px 20px;
    font-size: 0.95em;
}

.footer a {
    color: white;
    text-decoration: none;
    border-bottom: 2px solid rgba(255,255,255,0.3);
    transition: all 0.3s;
}

.footer a:hover {
    border-bottom-color: white;
}

.about-section {
    line-height: 1.9;
    color: #555;
}

.about-section h3 {
    margin: 30px 0 15px;
    color: #667eea;
    font-size: 1.4em;
}

.about-section ul {
    list-style: none;
    padding: 0;
}

.about-section li {
    padding: 10px 0;
    border-bottom: 1px solid rgba(102, 126, 234, 0.1);
}

.about-section li:last-child {
    border-bottom: none;
}

.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin: 30px 0;
}

.feature-box {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
    padding: 25px;
    border-radius: 15px;
    border: 2px solid rgba(102, 126, 234, 0.1);
}

.feature-box h4 {
    color: #667eea;
    margin-bottom: 10px;
    font-size: 1.2em;
}

@media (max-width: 768px) {
    header h1 { font-size: 2.5em; }
    .stats { grid-template-columns: repeat(2, 1fr); }
    .entity-grid { grid-template-columns: 1fr; }
    .quick-actions { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>
<div class="container">
    <header>
        <div class="header-icon">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                <circle cx="32" cy="16" r="6" fill="white" opacity="0.95"/>
                <circle cx="16" cy="32" r="6" fill="white" opacity="0.95"/>
                <circle cx="48" cy="32" r="6" fill="white" opacity="0.95"/>
                <circle cx="32" cy="48" r="6" fill="white" opacity="0.95"/>
                <line x1="32" y1="16" x2="16" y2="32" stroke="white" stroke-width="3" opacity="0.7"/>
                <line x1="32" y1="16" x2="48" y2="32" stroke="white" stroke-width="3" opacity="0.7"/>
                <line x1="16" y1="32" x2="32" y2="48" stroke="white" stroke-width="3" opacity="0.7"/>
                <line x1="48" y1="32" x2="32" y2="48" stroke="white" stroke-width="3" opacity="0.7"/>
            </svg>
            <h1>BioGraph</h1>
        </div>
        <p>Life Sciences Knowledge Graph ‚Ä¢ Obesity ‚Ä¢ Alzheimer's ‚Ä¢ KRAS Oncology</p>

        <div class="search-hero">
            <input type="text" class="search-input" placeholder="Search drugs, diseases, trials, targets..." id="heroSearch">
            <button class="search-btn" onclick="performSearch()">Search</button>
        </div>
    </header>

    <div class="stats" id="stats">
        <div class="stat-card" onclick="quickLoad('disease', 50)">
            <div class="icon">ü¶†</div>
            <div class="number" id="stat-diseases">-</div>
            <div class="label">Diseases</div>
        </div>
        <div class="stat-card" onclick="quickLoad('drug', 50)">
            <div class="icon">üíä</div>
            <div class="number" id="stat-drugs">-</div>
            <div class="label">Drugs</div>
        </div>
        <div class="stat-card" onclick="quickLoad('trial', 50)">
            <div class="icon">üî¨</div>
            <div class="number" id="stat-trials">-</div>
            <div class="label">Clinical Trials</div>
        </div>
        <div class="stat-card" onclick="quickLoad('publication', 50)">
            <div class="icon">üìÑ</div>
            <div class="number" id="stat-publications">-</div>
            <div class="label">Publications</div>
        </div>
        <div class="stat-card" onclick="switchTab('relationships')">
            <div class="icon">üîó</div>
            <div class="number" id="stat-edges">-</div>
            <div class="label">Relationships</div>
        </div>
    </div>

    <div class="main-card">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('entities')">üîç Explore Entities</button>
            <button class="tab" onclick="switchTab('relationships')">üîó Relationships</button>
            <button class="tab" onclick="switchTab('about')">‚ÑπÔ∏è About</button>
        </div>

        <div id="tab-entities" class="tab-content active">
            <h2>Explore the Knowledge Graph</h2>
            <div class="quick-actions">
                <button class="quick-btn" onclick="quickLoad('drug', 30)">üíä Drugs</button>
                <button class="quick-btn" onclick="quickLoad('disease', 30)">ü¶† Diseases</button>
                <button class="quick-btn" onclick="quickLoad('target', 30)">üéØ Targets</button>
                <button class="quick-btn" onclick="quickLoad('trial', 30)">üî¨ Trials</button>
                <button class="quick-btn" onclick="quickLoad('company', 30)">üè¢ Companies</button>
                <button class="quick-btn" onclick="quickLoad('publication', 30)">üìÑ Publications</button>
                <button class="quick-btn" onclick="quickLoad('patent', 20)">üìã Patents</button>
                <button class="quick-btn" onclick="quickLoad('news', 20)">üì∞ News</button>
            </div>
            <div class="controls">
                <select id="kind">
                    <option value="drug">üíä Drugs</option>
                    <option value="disease">ü¶† Diseases</option>
                    <option value="target">üéØ Targets</option>
                    <option value="trial">üî¨ Clinical Trials</option>
                    <option value="company">üè¢ Companies</option>
                    <option value="publication">üìÑ Publications</option>
                    <option value="patent">üìã Patents</option>
                    <option value="news">üì∞ News</option>
                </select>
                <input id="limit" type="number" value="30" min="1" max="100" placeholder="Limit" />
                <button id="loadEntities">Load Results</button>
            </div>
            <div class="results-container">
                <div id="entitiesOut"></div>
            </div>
        </div>

        <div id="tab-relationships" class="tab-content">
            <h2>Explore Relationships</h2>
            <div class="quick-actions">
                <button class="quick-btn" onclick="loadEdges('targets')">üéØ Drug ‚Üí Target</button>
                <button class="quick-btn" onclick="loadEdges('treats')">üíä Drug ‚Üí Disease</button>
                <button class="quick-btn" onclick="loadEdges('for_condition')">üî¨ Trial ‚Üí Disease</button>
                <button class="quick-btn" onclick="loadEdges('develops')">üè¢ Company ‚Üí Drug</button>
                <button class="quick-btn" onclick="loadEdges('mentions')">üìÑ Publication ‚Üí Drug</button>
                <button class="quick-btn" onclick="loadEdges('associated_with')">üéØ Target ‚Üí Disease</button>
                <button class="quick-btn" onclick="loadEdges('sponsored_by')">üî¨ Trial ‚Üí Company</button>
            </div>
            <div class="controls">
                <input id="pred" placeholder="Filter by relationship type (optional)" style="flex: 1;" />
                <input id="edgeLimit" type="number" value="50" min="1" max="200" />
                <button id="loadEdges">Load Relationships</button>
            </div>
            <div class="results-container">
                <div id="edgesOut"></div>
            </div>
        </div>

        <div id="tab-about" class="tab-content">
            <div class="about-section">
                <h2>About BioGraph</h2>
                <p>
                    BioGraph is a comprehensive life sciences knowledge graph that integrates data from authoritative public sources
                    to connect drugs, diseases, targets, clinical trials, publications, and companies. Built with modern entity resolution
                    and comprehensive MeSH indexing for PubMed-style semantic search.
                </p>

                <div class="feature-grid">
                    <div class="feature-box">
                        <h4>üéØ Entity Resolution</h4>
                        <p>Automatic deduplication during ingestion using canonical IDs from ChEMBL, MeSH, and CIK.</p>
                    </div>
                    <div class="feature-box">
                        <h4>üè∑Ô∏è MeSH Indexing</h4>
                        <p>Comprehensive MeSH term assignment across all categories for semantic search.</p>
                    </div>
                    <div class="feature-box">
                        <h4>üìä Confidence Scores</h4>
                        <p>All relationships tracked with confidence scores (0.0-1.0) for data quality.</p>
                    </div>
                    <div class="feature-box">
                        <h4>üîÑ Real-time Updates</h4>
                        <p>Discovery-driven architecture with entities emerging from authoritative data sources.</p>
                    </div>
                </div>

                <h3>Disease Areas (POC)</h3>
                <ul>
                    <li><strong>üíä Obesity & Metabolic Disorders:</strong> GLP-1 agonists, GIPR agonists, weight loss therapeutics</li>
                    <li><strong>üß† Alzheimer's Disease:</strong> Anti-amyloid antibodies, cholinesterase inhibitors, cognitive enhancers</li>
                    <li><strong>üß¨ KRAS Oncology:</strong> KRAS inhibitors, targeted cancer therapies</li>
                </ul>

                <h3>Data Sources</h3>
                <ul>
                    <li><strong>MeSH (2026):</strong> ~30K disease descriptors with hierarchical ontology</li>
                    <li><strong>ChEMBL:</strong> Drug molecules, targets, and mechanisms of action</li>
                    <li><strong>ClinicalTrials.gov:</strong> Clinical studies with entity resolution</li>
                    <li><strong>OpenTargets:</strong> Drug-target-disease associations with evidence scores</li>
                    <li><strong>PubMed:</strong> Scientific publications with official NLM MeSH indexing</li>
                    <li><strong>FDA:</strong> Drug approvals and regulatory information</li>
                    <li><strong>USPTO:</strong> Patent data linked to drugs and companies</li>
                    <li><strong>News Feeds:</strong> FDA, Fierce Pharma, BioPharma Dive with automated MeSH indexing</li>
                </ul>

                <h3>API Access</h3>
                <p style="margin-top: 20px; padding: 25px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 15px; border: 2px solid rgba(102, 126, 234, 0.2);">
                    <strong>Interactive API Documentation:</strong> Visit <a href="/docs" style="color: #667eea; font-weight: 600;">/docs</a>
                    for full API documentation with live testing. Access entities, relationships, and search endpoints programmatically.
                </p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p style="font-size: 1.1em; font-weight: 600; margin-bottom: 10px;">BioGraph Knowledge Graph</p>
        <p>
            <a href="/docs">API Documentation</a> ‚Ä¢
            <a href="/health">Health Check</a> ‚Ä¢
            <a href="https://github.com/anthropics/claude-code">Built with Claude Code</a>
        </p>
    </div>
</div>

<script>
let currentView = 'cards'; // or 'json'

async function getJSON(path) {
    const r = await fetch(path);
    if (!r.ok) throw new Error(await r.text());
    return await r.json();
}

async function loadStats() {
    try {
        const kinds = ['disease', 'drug', 'trial', 'publication'];
        const promises = kinds.map(k =>
            fetch(`/entities?kind=${k}&limit=1`)
                .then(r => r.json())
                .then(data => data.count || 0)
                .catch(() => 0)
        );

        const edgesPromise = fetch('/edges?limit=1')
            .then(r => r.json())
            .then(data => data.count || 0)
            .catch(() => 0);

        const [diseases, drugs, trials, publications, edges] = await Promise.all([...promises, edgesPromise]);

        document.getElementById('stat-diseases').textContent = diseases.toLocaleString();
        document.getElementById('stat-drugs').textContent = drugs.toLocaleString();
        document.getElementById('stat-trials').textContent = trials.toLocaleString();
        document.getElementById('stat-publications').textContent = publications.toLocaleString();
        document.getElementById('stat-edges').textContent = edges.toLocaleString();
    } catch (e) {
        console.error('Failed to load stats:', e);
    }
}

function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

    event.target.classList.add('active');
    document.getElementById('tab-' + tab).classList.add('active');
}

async function quickLoad(kind, limit) {
    document.getElementById('kind').value = kind;
    document.getElementById('limit').value = limit;
    switchTab('entities');
    await loadEntitiesHandler();
}

function renderEntityCards(items) {
    if (!items || items.length === 0) {
        return '<p style="text-align: center; color: #999; padding: 40px;">No results found</p>';
    }

    return '<div class="entity-grid">' + items.map(item => `
        <div class="entity-card" onclick="showEntityDetail(${item.id}, '${escapeHtml(item.name)}', '${item.kind}')" style="cursor: pointer;">
            <div class="entity-name">${escapeHtml(item.name || 'Unnamed')}</div>
            <div class="entity-id">${escapeHtml(item.canonical_id || item.id)}</div>
            <span class="entity-kind kind-${item.kind}">${item.kind}</span>
        </div>
    `).join('') + '</div>';
}

function renderEdgeCards(items) {
    if (!items || items.length === 0) {
        return '<p style="text-align: center; color: #999; padding: 40px;">No relationships found</p>';
    }

    return items.map(item => `
        <div class="edge-card">
            <div>
                <span class="entity-label" onclick="showEntityDetail(${item.src_id}, '${escapeHtml(item.src_name)}', '${item.src_kind}')" style="cursor: pointer; text-decoration: underline; text-decoration-color: rgba(102, 126, 234, 0.3); text-underline-offset: 3px;">
                    ${escapeHtml(item.src_name)}
                </span>
                <span style="color: #999; font-size: 0.9em;"> (${item.src_kind})</span>
            </div>
            <div class="edge-predicate">${escapeHtml(item.predicate)}</div>
            <div>
                <span class="entity-label" onclick="showEntityDetail(${item.dst_id}, '${escapeHtml(item.dst_name)}', '${item.dst_kind}')" style="cursor: pointer; text-decoration: underline; text-decoration-color: rgba(118, 75, 162, 0.3); text-underline-offset: 3px;">
                    ${escapeHtml(item.dst_name)}
                </span>
                <span style="color: #999; font-size: 0.9em;"> (${item.dst_kind})</span>
            </div>
            <div style="margin-top: 10px; font-size: 0.85em; color: #999;">
                Source: ${item.source} ${item.confidence ? `‚Ä¢ Confidence: ${(item.confidence * 100).toFixed(0)}%` : ''}
            </div>
        </div>
    `).join('');
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

async function loadEntitiesHandler() {
    const kind = document.getElementById('kind').value;
    const limit = document.getElementById('limit').value;
    const out = document.getElementById('entitiesOut');

    out.innerHTML = '<div class="loading">Loading entities</div>';

    try {
        const data = await getJSON(`/entities?kind=${encodeURIComponent(kind)}&limit=${encodeURIComponent(limit)}`);
        out.innerHTML = renderEntityCards(data.items);
    } catch (e) {
        out.innerHTML = `<div style="color: #d32f2f; padding: 20px; text-align: center;">Error: ${escapeHtml(String(e))}</div>`;
    }
}

async function loadEdges(predicate) {
    document.getElementById('pred').value = predicate || '';
    await loadEdgesHandler();
}

async function loadEdgesHandler() {
    const pred = document.getElementById('pred').value.trim();
    const limit = document.getElementById('edgeLimit').value;
    const out = document.getElementById('edgesOut');

    out.innerHTML = '<div class="loading">Loading relationships</div>';

    try {
        const qs = new URLSearchParams();
        if (pred) qs.set('predicate', pred);
        qs.set('limit', limit);
        const data = await getJSON(`/edges?${qs.toString()}`);
        out.innerHTML = renderEdgeCards(data.items);
    } catch (e) {
        out.innerHTML = `<div style="color: #d32f2f; padding: 20px; text-align: center;">Error: ${escapeHtml(String(e))}</div>`;
    }
}

async function performSearch() {
    const query = document.getElementById('heroSearch').value.trim();
    if (!query) return;

    // Simple search across all entity types
    // You can enhance this with a proper search endpoint
    alert(`Search functionality coming soon! Searching for: "${query}"`);
}

async function showEntityDetail(entityId, entityName, entityKind) {
    const out = document.getElementById('entitiesOut');

    out.innerHTML = '<div class="loading">Loading entity details and relationships</div>';

    try {
        // Fetch relationships where this entity is the source
        const outgoingPromise = fetch(`/edges?src_id=${entityId}&limit=200`)
            .then(r => r.json())
            .catch(() => ({items: []}));

        // Fetch relationships where this entity is the destination
        const incomingPromise = fetch(`/edges?dst_id=${entityId}&limit=200`)
            .then(r => r.json())
            .catch(() => ({items: []}));

        const [outgoing, incoming] = await Promise.all([outgoingPromise, incomingPromise]);

        const outgoingEdges = outgoing.items || [];
        const incomingEdges = incoming.items || [];
        const totalRels = outgoingEdges.length + incomingEdges.length;

        // Render detail view
        let html = `
            <div style="margin-bottom: 30px;">
                <button onclick="loadEntitiesHandler()" style="margin-bottom: 20px; background: #f0f0f0; color: #667eea; border: 2px solid #667eea;">
                    ‚Üê Back to List
                </button>

                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 30px; border-radius: 20px; border: 2px solid rgba(102, 126, 234, 0.2); margin-bottom: 30px;">
                    <h2 style="margin: 0 0 15px 0; font-size: 2.5em;">${escapeHtml(entityName)}</h2>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <span class="entity-kind kind-${entityKind}" style="font-size: 1em; padding: 8px 16px;">${entityKind}</span>
                        <span style="color: #667eea; font-weight: 600;">ID: ${entityId}</span>
                        <span style="color: #764ba2; font-weight: 600;">${totalRels} Relationship${totalRels !== 1 ? 's' : ''}</span>
                    </div>
                </div>
        `;

        if (outgoingEdges.length > 0) {
            html += `
                <h3 style="color: #667eea; margin: 30px 0 15px 0; font-size: 1.5em;">
                    Outgoing Relationships (${outgoingEdges.length})
                </h3>
                ${renderEdgeCards(outgoingEdges)}
            `;
        }

        if (incomingEdges.length > 0) {
            html += `
                <h3 style="color: #764ba2; margin: 30px 0 15px 0; font-size: 1.5em;">
                    Incoming Relationships (${incomingEdges.length})
                </h3>
                ${renderEdgeCards(incomingEdges)}
            `;
        }

        if (totalRels === 0) {
            html += '<p style="text-align: center; color: #999; padding: 60px 20px; font-size: 1.2em;">No relationships found for this entity</p>';
        }

        html += '</div>';

        out.innerHTML = html;

        // Scroll to top of results
        out.scrollIntoView({ behavior: 'smooth', block: 'start' });

    } catch (e) {
        out.innerHTML = `
            <button onclick="loadEntitiesHandler()" style="margin-bottom: 20px;">‚Üê Back to List</button>
            <div style="color: #d32f2f; padding: 20px; text-align: center;">Error loading entity details: ${escapeHtml(String(e))}</div>
        `;
    }
}

document.getElementById('loadEntities').onclick = loadEntitiesHandler;
document.getElementById('loadEdges').onclick = loadEdgesHandler;
document.getElementById('heroSearch').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') performSearch();
});

// Load stats on page load
loadStats();

// Initial load
loadEntitiesHandler();
</script>
</body>
</html>
